#Unicar

  Ao preencher a tela de registro, é feita uma validação básica dos dados. Se o nome não está vazio, se o email segue o regex da expressão “^[a-zA-Z0-9._%+-]+@ufvjm\.edu\.br$”, que determina que é um e-mail institucional da ufvjm (começa com qualquer coisa e termina com “@ufvjm.edu.br”). Além de verificar se a senha e a confirmação da senha são iguais. Após isso, esses dados são salvos em um arquivo serializado no formato JSON localmente, para que possa ser lido novamente ao fazer o login.

  Por fim, a tela de Login procura dentro dos perfis salvos, o que possui o mesmo email e senha, e caso tenha algum igual, redireciona para a tela de caronas, onde está presente o mapa.
  O mapa foi feito utilizando a API (Application Programming Interface) pública do serviço OpenStreetMap, que é Open Source. A princípio, foi cogitada a utilização da API do Google Maps, e foram feitos alguns testes com a mesma. Entretanto, por seu modelo de monetização, preferimos utilizar um serviço sem fins lucrativos. A requisição das imagens do mapa se baseia em duas coisas: qual o nível de zoom e qual tile do mapa está sendo requisitado.
Quanto maior o nível de zoom, maior é a quantidade de tiles que o mapa é subdividido. Isso pode ser calculado tanto horizontalmente quanto verticalmente com a fórmula 2zoom, sendo que para a quantidade total de tiles, seria 2zoom * 2zoom ou 22 * zoom. Assim, é possível fazer a conversão entre a latitude e longitude no mapa com a posição do tile na subdivisão, e vice-versa.

  Com isso, conseguimos pegar exatamente a posição que queremos do mapa e requisitar. Além disso, como é descrito na documentação da API, é necessário adicionar um header que descreve quem está requisitando aquela imagem.

  É necessário então realizar a navegação no mapa a partir da direção em que o usuário arrasta o dedo na tela. Para isso, são utilizados nove tiles, para que a navegação seja imperceptível e infinita. Sendo que o tile central é o que aparece em maior parte na tela, e os outros são usados para que não haja nenhum espaço.

  Assim, todos os tiles são movidos juntos, até que o tile central não se torne o mais próximo do centro. Nesse caso, calculamos qual dos tiles está mais próximo no momento. Se for o tile mais à esquerda, movemos todos os tiles mais à direita para a esquerda deles, mesma coisa com os tiles mais à direita, os tiles mais acima e os tiles mais abaixo. Assim, em conjunto com o paralelismo ao requisitar novos tiles, é possível oferecer uma navegação rápida e intuitiva. Por fim, são atualizados os índices dos tiles de acordo com o novo posicionamento.

  Além disso, o usuário deve possuir a habilidade de adicionar ou tirar o zoom do mapa, para melhor visualização dos dados. Para isso, utilizamos a fórmula para calcular qual a latitude e longitude do tile central, e aplicamos essas coordenadas utilizando o novo zoom como parâmetro. Já que, ao alterar o zoom, a quantidade de subdivisões também é alterada, fazendo com que as posições de tile anteriores mudem completamente. Assim, é possível obter um zoom que mantém (de forma aproximada) a coordenada central anterior.
Outra preocupação é a quantidade de requisições à API que, embora ela aceite várias requisições, caso o número passe de um limite aceitável, ela começa a bloquear novas requisições do mesmo agente. Por isso, é importante que guardemos na memória os tiles já requisitados, para que possam ser reaproveitados ao invés de serem pedidos novamente.
Para o uso do touch como input do usuário, a maioria já é lida corretamente pelo sistema de UI da Unity, mas na navegação do mapa, é necessário coletar o touch de dois dedos. Se apenas um dos dedos estiver tocando, então é um movimento padrão, que usará a direção do touch a partir da posição inicial. Senão, é necessário verificar o produto escalar entre a direção do segundo touch até o primeiro, e a direção de movimento do segundo touch. Assim, se o resultado for negativo, consideramos que estão em direções opostas, ou seja, está tentando diminuir o zoom. Caso contrário, está tentando aumentar o zoom, garantindo um controle intuitivo para o usuário.
